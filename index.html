<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Devis Instantané - XL Clean Sofa</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .hidden { display: none; }
    .progress-bar {
      height: 8px;
      background-color: #e5e7eb;
      border-radius: 5px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background-color: #ec4899;
      width: 0%;
      transition: width 0.4s ease;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

  <div class="w-full max-w-xl bg-white rounded-lg shadow-lg p-6 relative">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-pink-600">XL Clean Sofa</h1>
      <p class="text-gray-700">Obtenez votre devis en 5 minutes</p>
    </div>

    <div class="progress-bar mb-6">
      <div id="progress" class="progress"></div>
    </div>

    <form id="devisForm">
      <!-- Étapes dynamiques -->
      <div id="steps"></div>

      <!-- Navigation -->
      <div class="flex justify-between mt-6">
        <button type="button" id="backBtn" class="px-4 py-2 bg-gray-400 text-white rounded hidden">Retour</button>
        <button type="button" id="nextBtn" class="px-4 py-2 bg-pink-500 text-white rounded">Suivant</button>
      </div>
    </form>
  </div>

  <template id="step-template">
    <div class="step hidden">
      <label class="block text-gray-700 font-semibold mb-2"></label>
      <div class="input-container"></div>
      <p class="text-red-500 text-sm hidden">Champ obligatoire</p>
    </div>
  </template>

  <script>
    const questions = [
      { label: "1. Nom et Prénom", type: "text", id: "name", placeholder: "ex : Alan Favre", required: true },
      { label: "2. Adresse Email", type: "email", id: "email", placeholder: "ex : alan@example.com", required: true },
      { label: "3. Téléphone", type: "tel", id: "tel", placeholder: "ex : 077 345 34 45", pattern: /^\d{9,15}$/, required: true },
      { label: "4. Type de mobilier à nettoyer", type: "checkbox-group", id: "materiel", options: ["Canapé", "Fauteuil", "Chaise"], required: true },
      { label: "5. Matière du tissu", type: "checkbox-group", id: "matiere", options: ["Coton", "Velours", "Cuir", "Synthétique"], required: true },
      { label: "6. Couleur dominante", type: "checkbox-group", id: "couleur", options: ["Clair", "Foncé", "Coloré"], required: true },
      { label: "7. Types de tâches", type: "checkbox-group", id: "taches", options: ["Aliments", "Urine", "Sang", "Autre"], required: true },
      { label: "8. Y a-t-il des poils d’animaux ?", type: "radio", id: "animaux", options: ["Oui", "Non"], required: true },
      { label: "9. Degré de salissure (0 à 10)", type: "range", id: "salissure", min: 0, max: 10, required: true },
      { label: "10. Ajoutez des photos (optionnel)", type: "file", id: "photos", accept: "image/*", multiple: true },
    ];

    const stepsContainer = document.getElementById('steps');
    const template = document.getElementById('step-template');
    let currentStep = 0;

    questions.forEach((q, index) => {
      const step = template.content.cloneNode(true);
      const div = step.querySelector('.step');
      const label = step.querySelector('label');
      const inputContainer = step.querySelector('.input-container');
      label.textContent = q.label;

      if (q.type === "text" || q.type === "email" || q.type === "tel") {
        const input = document.createElement('input');
        input.type = q.type;
        input.id = q.id;
        input.placeholder = q.placeholder;
        input.className = "w-full p-2 border border-gray-300 rounded";
        if (q.pattern) input.pattern = q.pattern;
        if (q.required) input.required = true;
        inputContainer.appendChild(input);
      } else if (q.type === "checkbox-group") {
        q.options.forEach(opt => {
          const label = document.createElement('label');
          label.className = "block mb-1";
          label.innerHTML = `<input type="checkbox" name="${q.id}" value="${opt}" class="mr-2"> ${opt}`;
          inputContainer.appendChild(label);
        });
      } else if (q.type === "radio") {
        q.options.forEach(opt => {
          const label = document.createElement('label');
          label.className = "block mb-1";
          label.innerHTML = `<input type="radio" name="${q.id}" value="${opt}" class="mr-2"> ${opt}`;
          inputContainer.appendChild(label);
        });
      } else if (q.type === "range") {
        const input = document.createElement('input');
        input.type = 'range';
        input.min = q.min;
        input.max = q.max;
        input.value = 5;
        input.className = "w-full";
        input.id = q.id;
        inputContainer.appendChild(input);
      } else if (q.type === "file") {
        const input = document.createElement('input');
        input.type = 'file';
        input.id = q.id;
        input.accept = q.accept;
        if (q.multiple) input.multiple = true;
        input.className = "w-full";
        inputContainer.appendChild(input);
      }

      stepsContainer.appendChild(div);
    });

    const steps = document.querySelectorAll('.step');
    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');

    function updateProgress() {
      const percent = ((currentStep + 1) / steps.length) * 100;
      document.getElementById('progress').style.width = percent + '%';
    }

    function showStep() {
      steps.forEach((step, index) => step.classList.toggle('hidden', index !== currentStep));
      backBtn.classList.toggle('hidden', currentStep === 0);
      nextBtn.textContent = currentStep === steps.length - 1 ? "Terminer" : "Suivant";
      updateProgress();
    }

    nextBtn.addEventListener('click', () => {
      const currentInputs = steps[currentStep].querySelectorAll('input');
      const required = questions[currentStep].required;
      let valid = true;

      if (required) {
        if (questions[currentStep].type === 'checkbox-group') {
          valid = Array.from(currentInputs).some(i => i.checked);
        } else if (questions[currentStep].type === 'radio') {
          valid = Array.from(currentInputs).some(i => i.checked);
        } else {
          currentInputs.forEach(input => {
            if (!input.checkValidity()) valid = false;
          });
        }
      }

      if (!valid) {
        steps[currentStep].querySelector('p').classList.remove('hidden');
        return;
      }

      steps[currentStep].querySelector('p').classList.add('hidden');

      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep();
      } else {
        alert("Merci ! Le formulaire est complété.");
      }
    });

    backBtn.addEventListener('click', () => {
      if (currentStep > 0) {
        currentStep--;
        showStep();
      }
    });

    showStep();
  </script>
</body>
</html>
